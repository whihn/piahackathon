<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Demo</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width" />

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link href="css/shop-homepage.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>


    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <style>
        .productView {
            padding: 10px;
        }

        .productView img {
            max-width: -webkit-fill-available;
        }
    </style>
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <img src="https://media1.tchibo-content.de/newmedia/page/img/b14725cc6ea32e93/bean.svg"
                class="svgWithFallback js-tp-imagelazy--loaded"
                data-media-svg-fallback="https://media1.tchibo-content.de/newmedia/page/img/b0f725cc6ea32e93/bean.png"
                alt="" data-src="https://media1.tchibo-content.de/newmedia/page/img/b14725cc6ea32e93/bean.svg"
                data-lazyload="true">
            <a class="navbar-brand" href="#">Second Bean</a>

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="index">Home
                            <span class="sr-only">(current)</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="cart">Account</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div class="productView">

        <h1>3 Langarm-Bodys</h1>

        <img src="https://media2.tchibo-content.de/newmedia/art_img/MATCH_MAIN-CENSHARE/433281d72c732f22/3-langarm-bodys.jpg"
            alt="">

        <ul class="features">
            <li>
                <div>Hautsympathische reine Bio-Baumwolle </div>
            </li>
            <li>
                <div>GOTS zertifiziert </div>
            </li>
            <li>
                <div>Bis Größe 62/68 Wickelform: komplett zu öffnen durch Druckknöpfe an der Seite und im Schritt
                </div>
            </li>
            <li>
                <div>Ab Größe 74/80 Schlupfform: für einfaches An- und Ausziehen </div>
            </li>
            <li>
                <div>Weiche Feinripp-Qualität</div>
            </li>
            <li>
                <div>Auf Schadstoffe geprüft – von externen, akkreditierten Instituten</div>
            </li>
        </ul>

        <button type="button" class="btn btn-primary">Kaufen</button>

    </div>




    <button style="position: fixed; bottom: 6px; right: 6px"
        class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored">
        <a href="sellProduct" style="color: white"><i class="material-icons">attach_money</i></a>
    </button>
</body>
<script>
    function productRow(product) {
        return '                <tr>\n' +
            '                    <td class="col-md-6">\n' +
            '                        <div class="media">\n' +
            '                            <a class="thumbnail pull-left" href="#"> <img class="media-object" src="' + product.imageUrl + '" style="width: 72px; height: 72px;"> </a>\n' +
            '                            <div class="media-body">\n' +
            '                                <h4 class="media-heading"><a href="#">' + product.name + '</a></h4>\n' +
            '                                <h5 class="media-heading"> by <a href="#">Brand name</a></h5>\n' +
            '                            </div>\n' +
            '                        </div></td>\n' +
            '                    <td class="col-md-1 text-center"><strong>' + product.price + ' €</strong></td>\n' +
            '                    <td class="col-md-1">\n' +
            '                        <button type="button" class="btn">\n' +
            '                            <span class="glyphicon glyphicon-thumbs-up"></span> \n' +
            '                        </button></td>\n' +
            '                    <td class="col-md-1">\n' +
            '                        <button type="button" class="btn">\n' +
            '                            <span class="glyphicon glyphicon-thumbs-down"></span> \n' +
            '                        </button></td>\n' +
            '                </tr>\n';
    }

    function productCard(product) {
        return ' <div class="mdl-card mdl-shadow--2dp">\n' +
            '   <figure class="mdl-card__media">\n' +
            '    <img src="' + product.imageUrl + '" alt="" />\n' +
            '   </figure>\n' +
            '   <div class="mdl-card__title mdl-card--expand">\n' +
            '      <p class="mdl-card__title-text">' + product.name + '</p>\n' +
            '   </div>' +
            '  <div class="mdl-card__actions mdl-card--border">\n' +
            '    <button id="buy" class="mdl-button mdl-button--icon mdl-button--colored"><i title="buy" class="material-icons">shopping-cart</i></button>\n' +
            '    <button id="swap" class="mdl-button mdl-button--icon mdl-button--colored"><i title="swap"  class="material-icons">swap_horiz</i></button>\n' +
            '    <button id="sell" class="mdl-button mdl-button--icon mdl-button--colored"><i title="sell" class="material-icons">loyalty</i></button>\n' +
            '    <button id="wishlist" class="mdl-button mdl-button--icon mdl-button--colored"><i title="wishlist" class="material-icons">grade</i></button>\n' +
            '  </div>\n' +
            ' </div>';
    }

    function renderTags(tags) {
        $('#toptags').empty();

        tags.forEach((tag) => {
            const li = document.createElement("li");
            const a = document.createElement('a');
            a.setAttribute('onclick', 'onTagClicked(\'' + tag.tag + '\')');
            a.append(tag.tag);
            const span = document.createElement('span');
            span.append(tag.count);
            a.appendChild(span);
            li.appendChild(a);
            $('#toptags').append(li);
        });
    }

    function onSearchResponse(response) {
        const products = response.data;
        const tags = [];

        console.log('searchResponse: ', products);
        $('#cardContainer').empty();

        products.forEach((product) => {
            product.searchTags.forEach((tag) => {
                tags.push(tag);
            });
            $('#cardContainer').append(productCard(product));
        });
        renderTags(tags);
    }

    function onTagClicked(tag) {
        axios.get('/api/tagclicked', {
            params: {
                tagText: tag
            }
        })
            .then(onSearchResponse);

    }

    axios.get('/api/toptags', {
        params: {}
    })
        .then(response => {
            const topTags = response.data;
            renderTags(topTags);
        });

    $('#searchButton').on('click', function (e) {
        e.preventDefault();
        axios.get('/api/search', {
            params: {
                searchText: $('#searchText').val()
            }
        })
            .then(onSearchResponse);
    })


</script>
<!-- Bootstrap core JavaScript -->

</html>